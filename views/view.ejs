<!doctype html>

<html lang="en" class=" layout-navbar-fixed layout-menu-fixed layout-compact " dir="ltr" data-skin="default"
    data-assets-path="../../assets/" data-template="vertical-menu-template" data-bs-theme="light">

<!-- Mirrored from demos.themeselection.com/sneat-bootstrap-html-admin-template/html/vertical-menu-template/form-layouts-vertical.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 19 Jul 2025 20:47:10 GMT -->

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />


    <title>Cardify</title>

    <link rel="icon" type="image/x-icon" href="../../assets/cardifylogo2.png" />


    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com/" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&amp;display=swap"
        rel="stylesheet" />

    <link rel="stylesheet" href="../../assets/vendor/fonts/iconify-icons.css" />

    <!-- Core CSS -->
    <!-- build:css assets/vendor/css/theme.css  -->


    <link rel="stylesheet" href="../../assets/vendor/libs/pickr/pickr-themes.css" />

    <link rel="stylesheet" href="../../assets/vendor/css/core.css" />
    <link rel="stylesheet" href="../../assets/css/demo.css" />


    <!-- Vendors CSS -->

    <link rel="stylesheet" href="../../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <!-- endbuild -->

    <link rel="stylesheet" href="../../assets/vendor/libs/flatpickr/flatpickr.css" />
    <link rel="stylesheet" href="../../assets/vendor/libs/select2/select2.css" />

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">

    <style>
        .menu-item a:hover,
        .menu-item a.active {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }
    </style>

    <!-- Page CSS -->


    <!-- Helpers -->
    <script src="../../assets/vendor/js/helpers.js"></script>

    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->

    <script src="../../assets/js/config.js"></script>

</head>

<body>



    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar  ">
        <div class="layout-container">

            <!-- Menu -->

            <%-include('sidebar.ejs')-%>

                <div class="menu-mobile-toggler d-xl-none rounded-1">
                    <a href="javascript:void(0);"
                        class="layout-menu-toggle menu-link text-large text-bg-secondary p-2 rounded-1">
                        <i class="bx bx-menu icon-base"></i>
                        <i class="bx bx-chevron-right icon-base"></i>
                    </a>
                </div>
                <!-- / Menu -->



                <!-- Layout container -->
                <div class="layout-page">


                    <%-include('header.ejs')-%>

                        <!-- / Navbar -->


                        <!-- Content wrapper -->
                        <div class="content-wrapper">
                            <!-- Content -->
                            <div class="container-xxl flex-grow-1 container-p-y">

                                <!-- Basic Layout -->
                                <div class="row mb-6 gy-6">

                                </div>

                                <!-- Multi Column with Form Separator -->
                                <!-- <div class="card mb-6">
    <h5 class="card-header">Multi Column with Form Separator</h5>
    <form class="card-body">
      <h6>1. Account Details</h6>
      <div class="row g-6">
        <div class="col-md-6">
          <label class="form-label" for="multicol-username">Username</label>
          <input type="text" id="multicol-username" class="form-control" placeholder="john.doe" />
        </div>
        <div class="col-md-6">
          <label class="form-label" for="multicol-email">Email</label>
          <div class="input-group input-group-merge">
            <input type="text" id="multicol-email" class="form-control" placeholder="john.doe" aria-label="john.doe" aria-describedby="multicol-email2" />
            <span class="input-group-text" id="multicol-email2">@example.com</span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-password-toggle">
            <label class="form-label" for="multicol-password">Password</label>
            <div class="input-group input-group-merge">
              <input type="password" id="multicol-password" class="form-control" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="multicol-password2" />
              <span class="input-group-text cursor-pointer" id="multicol-password2"><i class="icon-base bx bx-hide"></i></span>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-password-toggle">
            <label class="form-label" for="multicol-confirm-password">Confirm Password</label>
            <div class="input-group input-group-merge">
              <input type="password" id="multicol-confirm-password" class="form-control" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="multicol-confirm-password2" />
              <span class="input-group-text cursor-pointer" id="multicol-confirm-password2"><i class="icon-base bx bx-hide"></i></span>
            </div>
          </div>
        </div>
      </div>
      <hr class="my-6 mx-n6" />
      <h6>2. Personal Info</h6>
      <div class="row g-6">
        <div class="col-md-6">
          <label class="form-label" for="multicol-first-name">First Name</label>
          <input type="text" id="multicol-first-name" class="form-control" placeholder="John" />
        </div>
        <div class="col-md-6">
          <label class="form-label" for="multicol-last-name">Last Name</label>
          <input type="text" id="multicol-last-name" class="form-control" placeholder="Doe" />
        </div>
        <div class="col-md-6">
          <label class="form-label" for="multicol-country">Country</label>
          <select id="multicol-country" class="select2 form-select" data-allow-clear="true">
            <option value="">Select</option>
            <option value="Australia">Australia</option>
            <option value="Bangladesh">Bangladesh</option>
            <option value="Belarus">Belarus</option>
            <option value="Brazil">Brazil</option>
            <option value="Canada">Canada</option>
            <option value="China">China</option>
            <option value="France">France</option>
            <option value="Germany">Germany</option>
            <option value="India">India</option>
            <option value="Indonesia">Indonesia</option>
            <option value="Israel">Israel</option>
            <option value="Italy">Italy</option>
            <option value="Japan">Japan</option>
            <option value="Korea">Korea, Republic of</option>
            <option value="Mexico">Mexico</option>
            <option value="Philippines">Philippines</option>
            <option value="Russia">Russian Federation</option>
            <option value="South Africa">South Africa</option>
            <option value="Thailand">Thailand</option>
            <option value="Turkey">Turkey</option>
            <option value="Ukraine">Ukraine</option>
            <option value="United Arab Emirates">United Arab Emirates</option>
            <option value="United Kingdom">United Kingdom</option>
            <option value="United States">United States</option>
          </select>
        </div>
        <div class="col-md-6 select2-primary">
          <label class="form-label" for="multicol-language">Language</label>
          <select id="multicol-language" class="select2 form-select" multiple>
            <option value="en" selected>English</option>
            <option value="fr" selected>French</option>
            <option value="de">German</option>
            <option value="pt">Portuguese</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label" for="multicol-birthdate">Birth Date</label>
          <input type="text" id="multicol-birthdate" class="form-control dob-picker" placeholder="YYYY-MM-DD" />
        </div>
        <div class="col-md-6">
          <label class="form-label" for="multicol-phone">Phone No</label>
          <input type="text" id="multicol-phone" class="form-control phone-mask" placeholder="658 799 8941" aria-label="658 799 8941" />
        </div>
      </div>
      <div class="pt-6">
        <button type="submit" class="btn btn-primary me-3">Submit</button>
        <button type="reset" class="btn btn-label-secondary">Cancel</button>
      </div>
    </form>
  </div> -->

                                <% if (event) { %>
                                    <!-- ðŸŸ¦ Event Details -->
                                    <div class="card bg-transparent shadow-none my-2 border-0"
                                        style="background-color: #f5f4f9 !important;">
                                        <div class="card-body row p-0 pb-6 g-6">
                                            <div class="col-12 col-lg-8 card-separator">
                                                <div class="mb-2 d-flex align-items-center">
                                                    <h3 class="mb-0 fw-bold me-3" style="color: #29317a;">
                                                        <%= event.event_name %>
                                                    </h3>
                                                    <span class="badge"
                                                        style="background-color: #ec9836; color: white;">Happening
                                                        Soon!</span>
                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                    <div class="card shadow-lg mb-4 rounded-4 overflow-hidden border-0">
                                        <div class="card-header  text-white text-center py-4"
                                            style="background-color: #29317a;">
                                            <!-- <h4 class="mb-0 fw-bold text-white">
                                                <%= event.event_name %>
                                            </h4> -->
                                        </div>
                                        <div class="card-body p-0">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item py-3">
                                                    <div class="d-flex align-items-center">
                                                        <i class="bx bx-info-circle text-primary me-3 fs-4"></i>
                                                        <div>
                                                            <strong class="text-secondary d-block">Description</strong>
                                                            <span>
                                                                <%= event.description %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="list-group-item py-3">
                                                    <div class="d-flex align-items-center">
                                                        <i class="bx bx-map text-primary me-3 fs-4"></i>
                                                        <div>
                                                            <strong class="text-secondary d-block">Location</strong>
                                                            <span>
                                                                <%= event.location %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="list-group-item py-3">
                                                    <div class="d-flex align-items-center">
                                                        <i class="bx bx-calendar text-primary me-3 fs-4"></i>
                                                        <div>
                                                            <strong class="text-secondary d-block">Date</strong>
                                                            <span>
                                                                <%= new Date(event.event_date).toLocaleDateString() %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="list-group-item py-3">
                                                    <div class="d-flex align-items-center">
                                                        <i class="bx bx-time-five text-primary me-3 fs-4"></i>
                                                        <div>
                                                            <strong class="text-secondary d-block">Start Time</strong>
                                                            <span>
                                                                <%= new Date(event.start_time).toLocaleTimeString([], {
                                                                    hour: '2-digit' , minute: '2-digit' }) %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="list-group-item py-3">
                                                    <div class="d-flex align-items-center">
                                                        <i class="bx bx-stopwatch text-primary me-3 fs-4"></i>
                                                        <div>
                                                            <strong class="text-secondary d-block">End Time</strong>
                                                            <span>
                                                                <%= new Date(event.end_time).toLocaleTimeString([], {
                                                                    hour: '2-digit' , minute: '2-digit' }) %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                    <!-- ðŸŸ© Add Guest Form -->
                                    <!-- <div class="card mb-4">
                                        <h5 class="card-header">Add Security</h5>
                                        <form id="securityForm" class="card-body row g-4">
                                            <input type="hidden" name="event_id" value="<%= event.id %>">

                                            <div class="col-md-6">
                                                <label class="form-label">First Name</label>
                                                <input type="text" name="firstname" class="form-control" required />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Last Name</label>
                                                <input type="text" name="lastname" class="form-control" required />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Phone</label>
                                                <input type="text" name="phone" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Email</label>
                                                <input type="email" name="email" class="form-control" required />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Password</label>
                                                <input type="password" name="password" class="form-control" required />
                                            </div>

                                            <div class="col-12">
                                                <button type="submit" class="btn btn-primary">Add Security</button>
                                            </div>
                                        </form>
                                    </div> -->

                                    <!-- ðŸŸ¦ Securities Table -->
                                    <!-- <div class="card mb-4">
                                        <h5 class="card-header">Security List</h5>
                                        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-light sticky-top">
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Full Name</th>
                                                        <th>Email</th>
                                                        <th>Phone</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="securityTableBody">
                                                    <% if (event.Securities && event.Securities.length> 0) { %>
                                                        <% event.Securities.forEach((s, i)=> { %>
                                                            <tr>
                                                                <td>
                                                                    <%= i + 1 %>
                                                                </td>
                                                                <td>
                                                                    <%= s.first_name %>
                                                                        <%= s.last_name %>
                                                                </td>
                                                                <td>
                                                                    <%= s.email %>
                                                                </td>
                                                                <td>
                                                                    <%= s.phone %>
                                                                </td>
                                                            </tr>
                                                            <% }) %>
                                                                <% } else { %>
                                                                    <tr>
                                                                        <td colspan="4" class="text-center text-muted">
                                                                            No securities added yet.</td>
                                                                    </tr>
                                                                    <% } %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div> -->

                                    <div class="card mb-4">
                                        <h5 class="card-header d-flex justify-content-between align-items-center">
                                            Security List
                                            <button class="btn btn-primary btn-sm" data-bs-toggle="offcanvas"
                                                data-bs-target="#addSecurityOffcanvas"
                                                aria-controls="addSecurityOffcanvas">
                                                Add Security
                                            </button>
                                        </h5>

                                        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-light sticky-top">
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Full Name</th>
                                                        <th>Email</th>
                                                        <th>Phone</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="securityTableBody">
                                                    <% if (event.Securities && event.Securities.length> 0) { %>
                                                        <% event.Securities.forEach((s, i)=> { %>
                                                            <tr>
                                                                <td>
                                                                    <%= i + 1 %>
                                                                </td>
                                                                <td>
                                                                    <%= s.first_name %>
                                                                        <%= s.last_name %>
                                                                </td>
                                                                <td>
                                                                    <%= s.email %>
                                                                </td>
                                                                <td>
                                                                    <%= s.phone %>
                                                                </td>
                                                            </tr>
                                                            <% }) %>
                                                                <% } else { %>
                                                                    <tr>
                                                                        <td colspan="4" class="text-center text-muted">
                                                                            No securities added yet.</td>
                                                                    </tr>
                                                                    <% } %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- ðŸŸ¥ Guest Table (Scrollable) -->
                                    <!-- <div class="card">
                                        <h5 class="card-header">Guest List</h5>
                                        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-light sticky-top">
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Guest Name</th>
                                                        <th>Email</th>
                                                        <th>Phone</th>
                                                        <th>Card Type</th>
                                                        <th>RSVP</th>
                                                        <th>QR Code</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% if (event.Guests && event.Guests.length> 0) { %>
                                                        <% event.Guests.forEach((g, i)=> { %>
                                                            <tr>
                                                                <td>
                                                                    <%= i + 1 %>
                                                                </td>
                                                                <td>
                                                                    <%= g.guest_name %>
                                                                </td>
                                                                <td>
                                                                    <%= g.email %>
                                                                </td>
                                                                <td>
                                                                    <%= g.phone %>
                                                                </td>
                                                                <td>
                                                                    <%= g.card_type %>
                                                                </td>
                                                                <td>
                                                                    <%= g.rsvp_status %>
                                                                </td>
                                                                <td>
                                                                    <% if (g.qr_code) { %>
                                                                        <img src="<%= g.qr_code %>" alt="QR"
                                                                            width="60" />
                                                                        <% } else { %>
                                                                            <span class="text-muted">N/A</span>
                                                                            <% } %>
                                                                </td>
                                                            </tr>
                                                            <% }) %>
                                                                <% } else { %>
                                                                    <tr>
                                                                        <td colspan="7" class="text-center text-muted">
                                                                            No guests added yet.</td>
                                                                    </tr>
                                                                    <% } %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <% } else { %>
                                        <p class="text-danger">No event data found.</p>
                                        <% } %> -->

                                    <div class="card">
                                        <div class="card-header pb-0 d-flex justify-content-between align-items-center">
                                            <h5 class="card-title mb-0">Guest List</h5>
                                            <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas"
                                                data-bs-target="#offcanvasAddGuest">
                                                <i class="bx bx-plus me-1"></i> Add Guest
                                            </button>
                                        </div>

                                        <div class="card-datatable table-responsive px-3 pt-2">
                                            <table class="datatables-basic table table-bordered table-hover text-nowrap"
                                                style="width: 100%;">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Name</th>
                                                        <th>Email</th>
                                                        <th>Phone</th>
                                                        <th>Card Type</th>
                                                        <th>QR Code</th>
                                                        <th class="text-center">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% if (event.Guests && event.Guests.length> 0) { %>
                                                        <% event.Guests.forEach((g, i)=> { %>
                                                            <tr>
                                                                <td>
                                                                    <%= i + 1 %>
                                                                </td>
                                                                <td>
                                                                    <%= g.guest_name %>
                                                                </td>
                                                                <td>
                                                                    <%= g.email %>
                                                                </td>
                                                                <td>
                                                                    <%= g.phone %>
                                                                </td>
                                                                <td>
                                                                    <%= g.card_type %>
                                                                </td>
                                                                <td>
                                                                    <% if (g.qr_code) { %>
                                                                        <img src="<%= g.qr_code %>" alt="QR"
                                                                            width="60" />
                                                                        <% } else { %>
                                                                            <span class="text-muted">N/A</span>
                                                                            <% } %>
                                                                </td>
                                                                <td class="text-center">
                                                                    <button
                                                                        class="btn btn-sm btn-outline-primary me-1">Edit</button>
                                                                    <button
                                                                        class="btn btn-sm btn-outline-danger">Delete</button>
                                                                </td>
                                                            </tr>
                                                            <% }) %>
                                                                <% } else { %>
                                                                    <tr>
                                                                        <td colspan="8" class="text-center text-muted">
                                                                            No
                                                                            guests added yet.</td>
                                                                    </tr>
                                                                    <% } %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>


                                    <!-- Form with Tabs -->



                            </div>
                            <!-- / Content -->




                            <!-- Footer -->
                            <footer class="content-footer footer bg-footer-theme">
                                <div class="container-xxl">
                                    <div
                                        class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column">
                                        <div class="mb-2 mb-md-0">
                                            Â©
                                            <script>
                                                document.write(new Date().getFullYear());
                                            </script>
                                            ,cardifyTz
                                        </div>

                                    </div>
                                </div>
                            </footer>
                            <!-- / Footer -->


                            <div class="content-backdrop fade"></div>
                            <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100;"></div>
                        </div>
                        <!-- Content wrapper -->
                </div>
                <!-- / Layout page -->
        </div>

        <div class="offcanvas offcanvas-end offcanvas-responsive" tabindex="-1" id="addSecurityOffcanvas"
            aria-labelledby="addSecurityOffcanvasLabel">
            <div class="offcanvas-header">
                <h5 id="addSecurityOffcanvasLabel">Add Security</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                    aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <form id="securityForm" class="row g-4">
                    <input type="hidden" name="event_id" value="<%= event.id %>">

                    <div class="col-md-6">
                        <label class="form-label">First Name</label>
                        <input type="text" name="firstname" class="form-control" required />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Last Name</label>
                        <input type="text" name="lastname" class="form-control" required />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Phone</label>
                        <input type="text" name="phone" class="form-control" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input type="email" name="email" class="form-control" required />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Password</label>
                        <input type="password" name="password" class="form-control" required />
                    </div>

                    <div class="col-12">
                        <button type="submit" class="btn btn-primary w-100">Add Security</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasAddGuest">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title">Add Guests</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                    aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">

                <!-- put your form sections here (manual/excel toggle, repeater form, submit button) -->
                <!-- you can literally paste the content you shared for "accordion2" here -->
                <div class="mt-3 question-section">
                    <label class="form-label fw-bold">How do you want to add Guests?</label>
                    <div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="add-method" id="add-manually"
                                value="manual" checked>
                            <label class="form-check-label" for="add-manually">Add Manually</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="add-method" id="upload-excel"
                                value="excel">
                            <label class="form-check-label" for="upload-excel">Upload Excel</label>
                        </div>
                    </div>
                </div>

                <!-- Manual repeater form (your existing .form-repeater) -->
                <form class="form-repeater mt-3">
                    <div data-repeater-list="contacts">
                        <div data-repeater-item>
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Guest Name</label>
                                    <input type="text" name="guest_name" class="form-control" placeholder="guest name"
                                        required />
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Card Type</label>
                                    <select name="card_type" class="form-select" required>
                                        <option value="" disabled selected>Select card type</option>
                                        <option value="Single">Single</option>
                                        <option value="Double">Double</option>
                                    </select>
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" name="email" class="form-control" placeholder="Email"
                                        required />
                                </div>
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="text" name="phone" class="form-control" placeholder="Phone" required />
                                </div>
                                <div class="col-md-1 d-flex align-items-end mb-3">
                                    <button type="button" data-repeater-delete
                                        class="btn btn-sm btn-outline-danger btn-remove-visitor">
                                        <i class="bx bx-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <hr />
                        </div>
                    </div>
                    <div class="col-12 d-flex justify-content-between">
                        <button type="button" data-repeater-create class="btn btn-outline-primary">
                            <i class="bx bx-plus"></i>
                        </button>
                    </div>
                </form>

                <!-- Excel upload -->
                <div id="excel-upload-section" class="mt-3 d-none">
                    <label class="form-label">Upload Excel of Visitors</label>
                    <input type="file" id="excel-upload-input" accept=".xlsx, .xls" class="form-control">
                    <div id="excel-preview-wrapper" class="mt-3 d-none">
                        <h6>Excel Preview:</h6>
                        <div class="table-responsive">
                            <table id="excel-preview-table" class="table table-bordered table-sm"></table>
                        </div>
                    </div>
                    <a href="/static/visitor-template1.xlsx" download
                        class="btn btn-outline-primary mt-2 download-template">
                        <em class="icon ni ni-download-cloud"></em> Download Template
                    </a>
                </div>

                <!-- Submit button -->
                <div class="col-12 d-flex justify-content-end mt-3">
                    <button class="btn btn-primary" id="submitBtn">
                        <i class="icon-base bx bx-check-circle icon-sm me-sm-2"></i>
                        <span class="align-middle">Submit</span>
                    </button>
                </div>

                <button type="button" class="btn btn-outline-primary d-none" id="animatedBtn1" disabled>
                    <span class="d-flex justify-content-center align-items-center" style="height: 20px;">
                        <!-- loading animation here -->
                    </span>
                </button>

            </div>
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>


        <!-- Drag Target Area To SlideIn Menu On Small Screens -->
        <div class="drag-target"></div>

    </div>
    <!-- / Layout wrapper -->





    <!-- Core JS -->
    <!-- build:js assets/vendor/js/theme.js  -->


    <script src="../../assets/vendor/libs/jquery/jquery.js"></script>

    <script src="../../assets/vendor/libs/popper/popper.js"></script>
    <script src="../../assets/vendor/js/bootstrap.js"></script>
    <script src="../../assets/vendor/libs/%40algolia/autocomplete-js.js"></script>



    <script src="../../assets/vendor/libs/pickr/pickr.js"></script>



    <script src="../../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>


    <script src="../../assets/vendor/libs/hammer/hammer.js"></script>

    <script src="../../assets/vendor/libs/i18n/i18n.js"></script>


    <script src="../../assets/vendor/js/menu.js"></script>

    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="../../assets/vendor/libs/cleave-zen/cleave-zen.js"></script>
    <script src="../../assets/vendor/libs/moment/moment.js"></script>
    <script src="../../assets/vendor/libs/flatpickr/flatpickr.js"></script>
    <script src="../../assets/vendor/libs/select2/select2.js"></script>

    <!-- Main JS -->

    <script src="../../assets/js/main.js"></script>


    <!-- Page JS -->
    <script src="../../assets/js/form-layouts.js"></script>
    <!-- DataTables CSS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

    <!-- DataTables core JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <!-- DataTables Bootstrap 5 integration -->
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <!-- Buttons + Responsive extensions -->
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bs-stepper/dist/js/bs-stepper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.repeater@1.2.1/jquery.repeater.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        window.addEventListener('pageshow', function (event) {
            if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
                // If coming from bfcache (Back/Forward cache), reload to enforce revalidation
                window.location.reload();
            }
        });

        $(document).ready(function () {
            const currentPath = window.location.pathname;
            console.log("Current Path:", currentPath);

            const parts = currentPath.split("/");
            const eventid = parts[parts.length - 1];
            console.log("Extracted Event ID:", eventid);

            $(".menu-link").each(function () {
                const linkPath = new URL(this.href).pathname;
                console.log("Link Path:", linkPath);
                if (linkPath === currentPath) {
                    $(this).addClass("active");
                } else {
                    $(this).removeClass("active");
                }
            });
        });

        $(document).ready(function () {
            $('.datatables-basic').DataTable({
                responsive: true,
                dom: "<'row mb-3'<'col-sm-12 col-md-4'l><'col-sm-12 col-md-4'f><'col-sm-12 col-md-4 text-end'B>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row mt-2'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
                buttons: [
                    { extend: 'copy', className: 'btn btn-sm btn-outline-secondary' },
                    { extend: 'csv', className: 'btn btn-sm btn-outline-secondary' },
                    { extend: 'excel', className: 'btn btn-sm btn-outline-success' },
                    { extend: 'pdf', className: 'btn btn-sm btn-outline-danger' },
                    { extend: 'print', className: 'btn btn-sm btn-outline-primary' }
                ]
            });
        });

        $('#securityForm').on('submit', function (e) {
            e.preventDefault();
            const firstname = $('input[name="firstname"]').val().trim();
            const lastname = $('input[name="lastname"]').val().trim();
            const phone = $('input[name="phone"]').val().trim();
            const email = $('input[name="email"]').val().trim();
            const password = $('input[name="password"]').val().trim();
            const event_id = $('input[name="event_id"]').val();

            if (!firstname || !lastname || !email || !password || !event_id) {
                showToast('Validation Error', 'Please fill in all required fields.', 'text-warning');
                return;
            }

            const formData = { firstname, lastname, phone, email, password, event_id };

            $.ajax({
                type: 'POST',
                url: '/user/security',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                beforeSend: function () {
                    $('#securityForm button[type="submit"]').prop('disabled', true);
                },
                success: function (res) {
                    showToast('Success', 'Security added.', 'text-success');
                    $('#securityForm')[0].reset();
                    $('#securityForm button[type="submit"]').prop('disabled', false);

                    // Close offcanvas
                    const offcanvasEl = document.getElementById('addSecurityOffcanvas');
                    const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
                    offcanvas.hide();

                    const tbody = $('#securityTableBody');

                    if (tbody.find('td').hasClass('text-muted')) {
                        tbody.empty(); // remove "no securities" row
                    }

                    const rowCount = tbody.find('tr').length + 1;
                    const newRow = `
                <tr>
                  <td>${rowCount}</td>
                  <td>${formData.firstname} ${formData.lastname}</td>
                  <td>${formData.email}</td>
                  <td>${formData.phone}</td>
                </tr>
            `;
                    tbody.append(newRow);
                },
                error: function (xhr) {
                    const message = xhr.responseJSON?.message || 'Failed to add security.';
                    showToast('Error', message, 'text-danger');
                    $('#securityForm button[type="submit"]').prop('disabled', false);
                }
            });
        });


        function showToast(title, body, titleClass) {
            const toastHtml = `
                <div class="toast align-items-center text-bg-light border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
                    <div class="toast-header">
                        <strong class="me-auto ${titleClass}">${title}</strong>
                        <small class="text-muted">Now</small>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">${body}</div>
                </div>`;

            const $toast = $(toastHtml);
            $('.toast-container').append($toast);
            const toast = new bootstrap.Toast($toast[0]);
            toast.show();
        }

        $(document).ready(function () {
            $('#logout-link').on('click', function (e) {
                e.preventDefault();

                console.log('reached')
                $.ajax({
                    type: 'POST',
                    url: '/user/logout',
                    contentType: 'application/json',
                    success: function (response) {
                        showToast("Success", "Logged out in successfully", "text-success");
                        window.location.href = '/'
                    },
                    error: function (xhr) {
                        let message = "Request failed. Please try again.";
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            message = xhr.responseJSON.message;
                        }
                        showToast("Error", message, "text-danger");
                        return;
                    },
                });
            })

            function showToast(title, body, titleClass) {
                const toastHtml = `
                <div class="toast align-items-center text-bg-light border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
                    <div class="toast-header">
                        <strong class="me-auto ${titleClass}">${title}</strong>
                        <small class="text-muted">Now</small>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">${body}</div>
                </div>`;

                const $toast = $(toastHtml);
                $('.toast-container').append($toast);
                const toast = new bootstrap.Toast($toast[0]);
                toast.show();
            }
        })

        $('.form-repeater').repeater({
            initEmpty: false,
            defaultValues: {
                'guest_name': '',
                'card_type': '',
                'email': '',
                'phone': ''
            },
            show: function () {
                $(this).slideDown();
            },
            hide: function (deleteElement) {
                Swal.fire({
                    title: 'Delete Entry?',
                    text: "Are you sure you want to remove this person?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $(this).slideUp(deleteElement);
                    }
                });
            }
        });

        $(document).ready(function () {
            $('input[name="add-method"]').on('change', function () {
                const method = $(this).val();

                if (method === 'manual') {
                    $('#manual-add-section').removeClass('d-none');
                    $('#excel-upload-section').addClass('d-none');
                    $('#excel-preview-wrapper').addClass('d-none');
                    $('.download-template').removeClass('d-none');
                    $('#excel-preview-table').empty();
                    $('#excel-upload-input').val('');
                    $('#accordion').show();
                    $('#extra-visitors-wrapper').show();
                    $('.form-repeater').removeClass('d-none');
                } else {
                    $('#manual-add-section').addClass('d-none');
                    $('.form-repeater').addClass('d-none');
                    $('#excel-upload-section').removeClass('d-none');
                    $('#accordion').hide();
                    $('#extra-visitors-wrapper').hide();
                }
            });

            // Trigger initial state
            $('input[name="add-method"]:checked').trigger('change');
        });

        $(document).ready(function () {
            $('#excel-upload-input').on('change', function (e) {
                const file = e.target.files[0];
                if (!file) return console.warn('No file selected');

                console.log('Selected file:', file);
                $('.download-template').addClass('d-none');
                const reader = new FileReader();

                reader.onload = function (e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];

                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        console.log('Excel parsed data:', jsonData);

                        if (!jsonData.length || jsonData[0].length === 0) {
                            $('#excel-preview-wrapper').addClass('d-none');
                            alert('Excel file is empty or missing headers.');
                            return;
                        }

                        // Build table
                        let tableHtml = '<thead><tr>';
                        jsonData[0].forEach(header => {
                            tableHtml += `<th>${header}</th>`;
                        });
                        tableHtml += '</tr></thead><tbody>';

                        jsonData.slice(1).forEach(row => {
                            tableHtml += '<tr>';
                            row.forEach(cell => {
                                tableHtml += `<td>${cell ?? ''}</td>`;
                            });
                            tableHtml += '</tr>';
                        });
                        tableHtml += '</tbody>';

                        $('#excel-preview-table').html(tableHtml);
                        $('#excel-preview-wrapper').removeClass('d-none');

                    } catch (err) {
                        console.error('Excel parsing error:', err);
                        alert('Error reading Excel file. Please ensure it is a valid .xlsx or .xls file.');
                    }
                };

                reader.readAsArrayBuffer(file);
            });
        });

        $(document).ready(function () {
            $('#submitBtn').on('click', function (e) {
                e.preventDefault();

                const currentPath = window.location.pathname;
                console.log("Current Path:", currentPath);

                const parts = currentPath.split("/");
                const eventId = parts[parts.length - 1];
                console.log("Extracted Event ID:", eventId);

                if (!eventId) {
                    showToast("Missing Event", "Event ID not found. Please create an event first.", "text-danger");
                    return;
                }

                const excelFile = $('#excel-upload-input')[0].files[0];

                $('#submitBtn').addClass('d-none');
                $('#animatedBtn1').removeClass('d-none');

                if (excelFile) {
                    const allowedExt = /\.(xlsx|xls|csv)$/i;
                    const maxSize = 5 * 1024 * 1024; // 5MB

                    if (!allowedExt.test(excelFile.name)) {
                        showToast("Validation Error", "Only Excel/CSV files are allowed.", "text-warning");
                        resetButtons();
                        return;
                    }

                    if (excelFile.size > maxSize) {
                        showToast("Validation Error", "File size exceeds 5MB limit.", "text-warning");
                        resetButtons();
                        return;
                    }

                    const formData = new FormData();
                    formData.append('file', excelFile);

                    $.ajax({
                        type: 'POST',
                        url: `/user/${eventId}/guests/upload`,
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (res) {
                            showToast("Success", "Guests uploaded via Excel.", "text-success");
                            resetButtons();
                            $('#accordion3').removeClass('d-none');
                            window.location.reload();
                            console.log(res);
                        },
                        error: function (xhr) {
                            const message = xhr.responseJSON?.message || "Excel upload failed.";
                            resetButtons();
                            showToast("Error", message, "text-danger");
                        }
                    });
                }

                else {
                    const contacts = $('.form-repeater').repeaterVal().contacts;
                    if (!contacts || contacts.length === 0) {
                        showToast("Validation Error", "Please add at least one guest manually or upload an Excel.", "text-warning");
                        resetButtons();
                        return;
                    }

                    for (let i = 0; i < contacts.length; i++) {
                        const c = contacts[i];
                        if (!c.guest_name || c.guest_name.trim() === "") {
                            showToast("Validation Error", `Guest ${i + 1}: Name is required.`, "text-warning");
                            resetButtons();
                            return;
                        }

                        if (!c.card_type || c.card_type.trim() === "") {
                            showToast("Validation Error", `Guest ${i + 1}: Card type is required.`, "text-warning");
                            resetButtons();
                            return;
                        }

                        if (!c.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)) {
                            showToast("Validation Error", `Guest ${i + 1}: Invalid email.`, "text-warning");
                            resetButtons();
                            return;
                        }

                        if (!c.phone || !/^\d{7,15}$/.test(c.phone)) {
                            showToast("Validation Error", `Guest ${i + 1}: Phone must be 7â€“15 digits.`, "text-warning");
                            resetButtons();
                            return;
                        }
                    }

                    $.ajax({
                        type: 'POST',
                        url: `/user/${eventId}/guests`,
                        contentType: 'application/json',
                        data: JSON.stringify({ guests: contacts }),
                        success: function (res) {
                            showToast("Success", "Guests added manually.", "text-success");
                            resetButtons();
                            window.location.reload();
                            $('#accordion3').removeClass('d-none');
                            console.log(res);
                        },
                        error: function (xhr) {
                            const message = xhr.responseJSON?.message || "Manual guest addition failed.";
                            resetButtons();
                            showToast("Error", message, "text-danger");
                        }
                    });
                }
            });

            function resetButtons() {
                $('#submitBtn').removeClass('d-none');
                $('#animatedBtn1').addClass('d-none');
            }

            function showToast(title, body, titleClass) {
                const toastHtml = `
        <div class="toast align-items-center text-bg-light border-0" 
             role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
          <div class="toast-header">
            <strong class="me-auto ${titleClass}">${title}</strong>
            <small class="text-muted">Now</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body">${body}</div>
        </div>`;

                const $toast = $(toastHtml);
                $('.toast-container').append($toast);
                new bootstrap.Toast($toast[0]).show();
            }
        });

    </script>


</body>

<!-- Mirrored from demos.themeselection.com/sneat-bootstrap-html-admin-template/html/vertical-menu-template/form-layouts-vertical.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 19 Jul 2025 20:47:12 GMT -->

</html>

<!-- beautify ignore:end -->